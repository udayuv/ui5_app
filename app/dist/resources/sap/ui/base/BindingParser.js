/*!
 * OpenUI5
 * (c) Copyright 2009-2024 SAP SE or an SAP affiliate company.
 * Licensed under the Apache License, Version 2.0 - see LICENSE.txt.
 */
sap.ui.define(["./ExpressionParser","sap/ui/model/BindingMode","sap/ui/model/Filter","sap/ui/model/Sorter","sap/base/future","sap/base/util/JSTokenizer","sap/base/util/resolveReference"],function(e,r,t,n,i,o,s){"use strict";var a={_keepBindingStrings:false};var f=/^\{\s*('|"|)[a-zA-Z$_][a-zA-Z0-9$_]*\1\s*:/;var u=/(\\[\\\{\}])|(\{)/g;var p=/([\\\{\}])/g;function c(e,r){var t=e.some(function(e){return e.requiresIContext});function n(n){var i,o=e.length,s=arguments,a=new Array(o);for(i=0;i<o;i+=1){if(e[i].requiresIContext){s=arguments}else if(t){s=Array.prototype.slice.call(arguments,1)}a[i]=e[i].apply(this,s)}if(r){return r.apply(this,a)}return o>1?a.join(" "):a[0]}if(t){n.requiresIContext=true}n.textFragments=r&&r.textFragments||"sap.ui.base.BindingParser: composeFormatters";return n}function l(e){var r=function(){var r=[],t=e.length,n;for(n=0;n<t;n++){if(typeof e[n]==="number"){r.push(arguments[e[n]])}else{r.push(e[n])}}return r.join("")};r.textFragments=e;return r}function d(e,r){var t=e.indexOf(">"),n={path:e};if(t>0){n.model=e.slice(0,t);n.path=e.slice(t+1)}if(r?.mLocals&&n.path.includes("@@")){n.parameters={scope:r.mLocals}}return n}function m(e,r){try{a.mergeParts(e)}catch(e){i.errorThrows("Cannot merge parts: "+e.message,r,"sap.ui.base.BindingParser")}}function h(e,r){var o=Object.assign({".":e.oContext},e.mLocals);function a(r,t){if(typeof r[t]==="string"){var n=r[t];r[t]=s(r[t],o,{preferDotContext:e.bPreferContext,bindDotContext:!e.bStaticContext});if(typeof r[t]!=="function"){if(e.bTolerateFunctionsNotFound){e.aFunctionsNotFound=e.aFunctionsNotFound||[];e.aFunctionsNotFound.push(n)}else{i.errorThrows(t+" function "+n+" not found!")}}}}function f(r){var t;var n=r.type;if(typeof n==="string"){t=s(n,o,{bindContext:false,useProbingRequire:!e.aTypePromises});var a=function(e){if(typeof e==="function"){r.type=new e(r.formatOptions,r.constraints)}else{r.type=e}if(!r.type){i.errorThrows("Failed to resolve type '"+n+"'. Maybe not loaded or a typo?")}delete r.formatOptions;delete r.constraints};if(e.aTypePromises){var f;if(typeof t==="function"&&!t._sapUiLazyLoader||t&&typeof t==="object"){f=Promise.resolve(a(t))}else{f=new Promise(function(e,r){sap.ui.require([n.replace(/\./g,"/")],e,r)}).catch(function(e){i.errorThrows(e)}).then(a)}e.aTypePromises.push(f)}else{a(t)}}}function u(e){if(e!=null&&typeof e==="object"){for(var r in e){a(e,r)}}}function p(e,r){var n=e[r];if(Array.isArray(n)){n.forEach(function(e,r){p(n,r)});return}if(n&&typeof n==="object"){a(n,"test");p(n,"filters");p(n,"condition");e[r]=new t(n)}}function c(e,r){var t=e[r];if(Array.isArray(t)){t.forEach(function(e,r){c(t,r)});return}if(t&&typeof t==="object"){a(t,"group");a(t,"comparator");e[r]=new n(t)}}if(typeof r==="object"){if(Array.isArray(r.parts)){r.parts.forEach(function(r){h(e,r)})}f(r);p(r,"filters");c(r,"sorter");u(r.events);a(r,"formatter");a(r,"factory");a(r,"groupHeaderFactory");if(e.mLocals&&r.path?.includes("@@")&&r.parameters?.scope===undefined){r.parameters??={};r.parameters.scope=e.mLocals}}return r}function y(e,r,t){var n=o.parseJS,i,s;if(f.test(r.slice(t))){i=n(r,t);h(e,i.result);return i}s=r.indexOf("}",t);if(s<t){throw new SyntaxError("no closing braces found in '"+r+"' after pos:"+t)}return{result:d(r.slice(t+1,s),e),at:s+1}}a.simpleParser=function(e){var r=arguments[7];var t;if(e.startsWith("{")&&e.endsWith("}")){t=d(e.slice(1,-1))}if(r){return{bindingInfo:t,resolved:Promise.resolve()}}return t};a.simpleParser.escape=function(e){return e};a.complexParser=function(t,n,i,o,s,f,p,c){var d=false,h={parts:[]},g=false,x={oContext:n,mLocals:p,aFunctionsNotFound:undefined,bPreferContext:f,bStaticContext:s,bTolerateFunctionsNotFound:o,aTypePromises:c?[]:undefined},v=[],b,F=0,P,w;function A(r,i,o){var a=e.parse(y.bind(null,x),t,i,null,p||(s?n:null));function f(e,r){if(e.parts){e.parts.forEach(function(r,t){if(typeof r==="string"){r=e.parts[t]={path:r}}f(r,t)});d=d||r!==undefined}else{e.mode=o}}if(r.charAt(a.at)!=="}"){throw new SyntaxError("Expected '}' and instead saw '"+r.charAt(a.at)+"' in expression binding "+r+" at position "+a.at)}a.at+=1;if(a.result){f(a.result)}else{v[v.length-1]=String(a.constant);b=true}return a}u.lastIndex=0;while((P=u.exec(t))!==null){if(F<P.index){v.push(t.slice(F,P.index))}if(P[1]){v.push(P[1].slice(1));b=true}else{v.push(h.parts.length);if(t.indexOf(":=",P.index)===P.index+1){w=A(t,P.index+3,r.OneTime)}else if(t.charAt(P.index+1)==="="){w=A(t,P.index+2,r.OneWay)}else{w=y(x,t,P.index)}if(w.result){h.parts.push(w.result);g=g||"parts"in w.result}u.lastIndex=w.at}F=u.lastIndex}if(F<t.length){v.push(t.slice(F))}if(h.parts.length>0){if(v.length===1){h=h.parts[0];g=d}else{h.formatter=l(v)}if(g){m(h,t)}if(a._keepBindingStrings){h.bindingString=t}if(x.aFunctionsNotFound){h.functionsNotFound=x.aFunctionsNotFound}if(c){return{bindingInfo:h,resolved:Promise.all(x.aTypePromises),wait:x.aTypePromises.length>0}}return h}else if(i&&b){var C=v.join("");if(c){return{bindingInfo:C,resolved:Promise.resolve()}}return C}};a.complexParser.escape=function(e){return e.replace(p,"\\$1")};a.mergeParts=function(e){var r=[],t=[];e.parts.forEach(function(e){var n,i=function(){return e},o,s=t.length;function a(){return arguments[s]}if(e&&typeof e==="object"){if(e.parts){for(o in e){if(o!=="formatter"&&o!=="parts"){throw new Error("Unsupported property: "+o)}}t=t.concat(e.parts);n=t.length;if(e.formatter){if(e.formatter.requiresIContext===true){i=function(r){var t=Array.prototype.slice.call(arguments,s+1,n+1);t.unshift(r._slice(s,n));return e.formatter.apply(this,t)};i.requiresIContext=true}else{i=function(){return e.formatter.apply(this,Array.prototype.slice.call(arguments,s,n))}}}else if(n-s>1){i=function(){return Array.prototype.slice.call(arguments,s,n).join(" ")}}else{i=a}}else if("path"in e){t.push(e);i=a}}r.push(i)});e.parts=t;e.formatter=c(r,e.formatter)};a.parseExpression=function(r,t,n,i){n=n||{};if(i){n.mLocals=i}return e.parse(y.bind(null,n),r,t,i)};return a},true);
//# sourceMappingURL=BindingParser.js.map